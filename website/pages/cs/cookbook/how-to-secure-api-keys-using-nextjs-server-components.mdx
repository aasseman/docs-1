---
title: Jak zabezpečit klíče API pomocí komponent serveru Next.js
---

## Přehled

K řádnému zabezpečení našeho klíče API před odhalením ve frontendu naší aplikace můžeme použít [komponenty serveru Next.js](https://nextjs.org/docs/app/building-your-application/rendering/server-components). Pro další zvýšení zabezpečení našeho klíče API můžeme také [omezit náš klíč API na určité podgrafy nebo domény v Podgraf Studio](/cookbook/upgrading-a-subgraph/#securing-your-api-key).

V této kuchařce probereme, jak vytvořit serverovou komponentu Next.js, která se dotazuje na podgraf a zároveň skrývá klíč API před frontend.

### Upozornění

- Součásti serveru Next.js nechrání klíče API před odčerpáním pomocí útoků typu odepření služby.
- Brány Graf síť mají zavedené strategie detekce a zmírňování odepření služby, avšak použití serverových komponent může tyto ochrany oslabit.
- Server komponenty Next.js přinášejí rizika centralizace, protože může dojít k výpadku serveru.

### Proč je to důležité

Ve standardní aplikaci React mohou být klíče API obsažené v kódu frontendu vystaveny na straně klienta, což představuje bezpečnostní riziko. Soubory `.env` se sice běžně používají, ale plně klíče nechrání, protože kód Reactu se spouští na straně klienta a vystavuje klíč API v hlavičkách. Serverové komponenty Next.js tento problém řeší tím, že citlivé operace zpracovávají na straně serveru.

### Použití vykreslování na straně klienta k dotazování podgrafu

![Client-side rendering](/img/api-key-client-side-rendering.png)

### Požadavky

- Klíč API od [Subgraph Studio](https://thegraph.com/studio)
- Basic knowledge of Next.js and React.
- An existing Next.js project that uses the [App Router](https://nextjs.org/docs/app).

## Step-by-Step Cookbook

### Step 1: Set Up Environment Variables

1. In our Next.js project root, create a `.env.local` file.
2. Add our API key: `API_KEY=<api_key_here>`.

### Step 2: Create a Server Component

1. In our `components` directory, create a new file, `ServerComponent.js`.
2. Use the provided example code to set up the server component.

### Step 3: Implement Server-Side API Request

In `ServerComponent.js`, add the following code:

```javascript
const API_KEY = process.env.API_KEY

export default async function ServerComponent() {
  const response = await fetch(
    `https://gateway-arbitrum.network.thegraph.com/api/${API_KEY}/subgraphs/id/HUZDsRpEVP2AvzDCyzDHtdc64dyDxx8FQjzsmqSg4H3B`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        query: /* GraphQL */ `
          {
            factories(first: 5) {
              id
              poolCount
              txCount
              totalVolumeUSD
            }
          }
        `,
      }),
    },
  )

  const responseData = await response.json()
  const data = responseData.data

  return (
    <div>
      <h1>Server Component</h1>
      {data ? (
        <ul>
          {data.factories.map((factory) => (
            <li key={factory.id}>
              <p>ID: {factory.id}</p>
              <p>Pool Count: {factory.poolCount}</p>
              <p>Transaction Count: {factory.txCount}</p>
              <p>Total Volume USD: {factory.totalVolumeUSD}</p>
            </li>
          ))}
        </ul>
      ) : (
        <p>Loading data...</p>
      )}
    </div>
  )
}
```

### Step 4: Use the Server Component

1. In our page file (e.g., `pages/index.js`), import `ServerComponent`.
2. Render the component:

```javascript
import ServerComponent from './components/ServerComponent'

export default function Home() {
  return (
    <main>
      <ServerComponent />
    </main>
  )
}
```

### Step 5: Run and Test Our Dapp

Start our Next.js application using `npm run dev`. Verify that the server component is fetching data without exposing the API key.

![Server-side rendering](/img/api-key-server-side-rendering.png)

### Závěr

By utilizing Next.js Server Components, we've effectively hidden the API key from the client-side, enhancing the security of our application. This method ensures that sensitive operations are handled server-side, away from potential client-side vulnerabilities. Finally, be sure to explore [other API key security measures](/cookbook/upgrading-a-subgraph/#securing-your-api-key) to increase your API key security even further.
